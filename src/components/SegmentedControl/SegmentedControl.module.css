.SegmentedControl {
  --segmented-control-option-radius: calc(
    var(--segmented-control-radius) - var(--segmented-control-gutter)
  );

  position: relative;
  overflow: auto;
  display: inline-flex;
  flex-wrap: nowrap;
  gap: var(--segmented-control-gap);
  height: var(--segmented-control-size);
  padding: var(--segmented-control-gutter);
  border-radius: var(--segmented-control-radius);
  background: var(--segmented-control-background);
  font-size: var(--segmented-control-font-size);
  font-weight: var(--segmented-control-font-weight);
  -ms-overflow-style: none;
  scrollbar-width: none;
  /* Remove inline-flex baseline gap */
  vertical-align: middle;
  white-space: nowrap;

  &::-webkit-scrollbar {
    width: 0;
    height: 0;
  }

  &::-webkit-scrollbar-track,
  &::-webkit-scrollbar-thumb {
    background: transparent;
  }

  &:where([data-block]) {
    overflow: hidden;
    display: flex;
    width: 100%;
    white-space: normal;
  }

  /* =============================================
    Sizes
  ============================================= */
  &:where([data-size="3xs"]) {
    --segmented-control-size: var(--control-size-3xs);
    --segmented-control-font-size: var(--control-font-size-sm);
    --segmented-control-radius: var(--control-radius-sm);
    --segmented-control-option-gutter: var(--control-gutter-xs);
    /* Icon and content */
    --segmented-control-icon-size: var(--control-icon-size-xs);
    --segmented-control-content-gap: var(--button-gap-sm);
    --segmented-control-icon-offset: -1px;
    --segmented-control-badge-offset: -1px;
    /* Badge tokens — inherited from badge-size-2xs */
    --option-badge-size: var(--badge-size-2xs);
    --option-badge-gutter: var(--badge-gutter-2xs);
    --option-badge-font-size: var(--badge-font-size-2xs);
    --option-badge-font-weight: var(--badge-font-weight-2xs);
    --option-badge-tracking: var(--badge-tracking-2xs);
    --option-badge-radius: var(--badge-radius-2xs);
  }

  &:where([data-size="2xs"]) {
    --segmented-control-size: var(--control-size-2xs);
    --segmented-control-font-size: var(--control-font-size-sm);
    --segmented-control-radius: var(--control-radius-sm);
    --segmented-control-option-gutter: var(--control-gutter-xs);
    /* Icon and content */
    --segmented-control-icon-size: var(--control-icon-size-sm);
    --segmented-control-content-gap: var(--button-gap-md);
    --segmented-control-icon-offset: -1px;
    --segmented-control-badge-offset: -1px;
    /* Badge tokens — inherited from badge-size-2xs */
    --option-badge-size: var(--badge-size-2xs);
    --option-badge-gutter: var(--badge-gutter-2xs);
    --option-badge-font-size: var(--badge-font-size-2xs);
    --option-badge-font-weight: var(--badge-font-weight-2xs);
    --option-badge-tracking: var(--badge-tracking-2xs);
    --option-badge-radius: var(--badge-radius-2xs);
  }

  &:where([data-size="xs"]) {
    --segmented-control-size: var(--control-size-xs);
    --segmented-control-font-size: var(--control-font-size-md);
    --segmented-control-radius: var(--control-radius-sm);
    --segmented-control-option-gutter: var(--control-gutter-xs);
    /* Icon and content */
    --segmented-control-icon-size: var(--control-icon-size-sm);
    --segmented-control-content-gap: var(--button-gap-md);
    --segmented-control-icon-offset: -1px;
    --segmented-control-badge-offset: -1px;
    /* Badge tokens — inherited from badge-size-xs */
    --option-badge-size: var(--badge-size-xs);
    --option-badge-gutter: var(--badge-gutter-xs);
    --option-badge-font-size: var(--badge-font-size-xs);
    --option-badge-font-weight: var(--badge-font-weight-xs);
    --option-badge-tracking: var(--badge-tracking-xs);
    --option-badge-radius: var(--badge-radius-xs);
  }

  &:where([data-size="sm"]) {
    --segmented-control-size: var(--control-size-sm);
    --segmented-control-font-size: var(--control-font-size-md);
    --segmented-control-radius: var(--control-radius-md);
    --segmented-control-option-gutter: var(--control-gutter-sm);
    /* Icon and content */
    --segmented-control-icon-size: var(--control-icon-size-md);
    --segmented-control-content-gap: var(--button-gap-md);
    --segmented-control-icon-offset: -1px;
    --segmented-control-badge-offset: -1px;
    /* Badge tokens — inherited from badge-size-sm */
    --option-badge-size: var(--badge-size-sm);
    --option-badge-gutter: var(--badge-gutter-sm);
    --option-badge-font-size: var(--badge-font-size-sm);
    --option-badge-font-weight: var(--badge-font-weight-sm);
    --option-badge-tracking: var(--badge-tracking-sm);
    --option-badge-radius: var(--badge-radius-sm);
  }

  &:where([data-size="md"]) {
    --segmented-control-size: var(--control-size-md);
    --segmented-control-font-size: var(--control-font-size-md);
    --segmented-control-radius: var(--control-radius-md);
    --segmented-control-option-gutter: var(--control-gutter-md);
    /* Icon and content */
    --segmented-control-icon-size: var(--control-icon-size-md);
    --segmented-control-content-gap: var(--button-gap-lg);
    --segmented-control-icon-offset: -1px;
    --segmented-control-badge-offset: -1px;
    /* Badge tokens — inherited from badge-size-md */
    --option-badge-size: var(--badge-size-md);
    --option-badge-gutter: var(--badge-gutter-md);
    --option-badge-font-size: var(--badge-font-size-md);
    --option-badge-font-weight: var(--badge-font-weight-md);
    --option-badge-tracking: var(--badge-tracking-md);
    --option-badge-radius: var(--badge-radius-md);
  }

  &:where([data-size="lg"]) {
    --segmented-control-size: var(--control-size-lg);
    --segmented-control-font-size: var(--control-font-size-md);
    --segmented-control-radius: var(--control-radius-md);
    --segmented-control-option-gutter: var(--control-gutter-md);
    /* Icon and content */
    --segmented-control-icon-size: var(--control-icon-size-md);
    --segmented-control-content-gap: var(--button-gap-lg);
    --segmented-control-icon-offset: -1px;
    --segmented-control-badge-offset: -1px;
    /* Badge tokens — inherited from badge-size-md */
    --option-badge-size: var(--badge-size-md);
    --option-badge-gutter: var(--badge-gutter-md);
    --option-badge-font-size: var(--badge-font-size-md);
    --option-badge-font-weight: var(--badge-font-weight-md);
    --option-badge-tracking: var(--badge-tracking-md);
    --option-badge-radius: var(--badge-radius-md);
  }

  &:where([data-size="xl"]) {
    --segmented-control-size: var(--control-size-xl);
    --segmented-control-font-size: var(--control-font-size-md);
    --segmented-control-radius: var(--control-radius-lg);
    --segmented-control-option-gutter: var(--control-gutter-lg);
    /* Icon and content */
    --segmented-control-icon-size: var(--control-icon-size-md);
    --segmented-control-content-gap: var(--button-gap-lg);
    --segmented-control-icon-offset: -1px;
    --segmented-control-badge-offset: -1px;
    /* Badge tokens — inherited from badge-size-md */
    --option-badge-size: var(--badge-size-md);
    --option-badge-gutter: var(--badge-gutter-md);
    --option-badge-font-size: var(--badge-font-size-md);
    --option-badge-font-weight: var(--badge-font-weight-md);
    --option-badge-tracking: var(--badge-tracking-md);
    --option-badge-radius: var(--badge-radius-md);
  }

  &:where([data-size="2xl"]) {
    --segmented-control-size: var(--control-size-2xl);
    --segmented-control-font-size: var(--control-font-size-lg);
    --segmented-control-radius: var(--control-radius-xl);
    --segmented-control-option-gutter: var(--control-gutter-xl);
    /* Icon and content */
    --segmented-control-icon-size: var(--control-icon-size-lg);
    --segmented-control-content-gap: var(--button-gap-lg);
    --segmented-control-icon-offset: -2px;
    --segmented-control-badge-offset: -2px;
    /* Badge tokens — inherited from badge-size-lg */
    --option-badge-size: var(--badge-size-lg);
    --option-badge-gutter: var(--badge-gutter-lg);
    --option-badge-font-size: var(--badge-font-size-lg);
    --option-badge-font-weight: var(--badge-font-weight-lg);
    --option-badge-tracking: var(--badge-tracking-lg);
    --option-badge-radius: var(--badge-radius-lg);
  }

  &:where([data-size="3xl"]) {
    --segmented-control-size: var(--control-size-3xl);
    --segmented-control-font-size: var(--control-font-size-lg);
    --segmented-control-radius: var(--control-radius-xl);
    --segmented-control-option-gutter: var(--control-gutter-xl);
    /* Icon and content */
    --segmented-control-icon-size: var(--control-icon-size-lg);
    --segmented-control-content-gap: var(--button-gap-lg);
    --segmented-control-icon-offset: -2px;
    --segmented-control-badge-offset: -2px;
    /* Badge tokens — inherited from badge-size-lg */
    --option-badge-size: var(--badge-size-lg);
    --option-badge-gutter: var(--badge-gutter-lg);
    --option-badge-font-size: var(--badge-font-size-lg);
    --option-badge-font-weight: var(--badge-font-weight-lg);
    --option-badge-tracking: var(--badge-tracking-lg);
    --option-badge-radius: var(--badge-radius-lg);
  }

  /* =============================================
    Gutter sizes
  ============================================= */
  &:where([data-gutter-size="2xs"]) {
    --segmented-control-option-gutter: var(--control-gutter-2xs);
  }

  &:where([data-gutter-size="xs"]) {
    --segmented-control-option-gutter: var(--control-gutter-xs);
  }

  &:where([data-gutter-size="sm"]) {
    --segmented-control-option-gutter: var(--control-gutter-sm);
  }

  &:where([data-gutter-size="md"]) {
    --segmented-control-option-gutter: var(--control-gutter-md);
  }

  &:where([data-gutter-size="lg"]) {
    --segmented-control-option-gutter: var(--control-gutter-lg);
  }

  &:where([data-gutter-size="xl"]) {
    --segmented-control-option-gutter: var(--control-gutter-xl);
  }

  /* =============================================
    Pill
  ============================================= */
  &:where([data-pill]) {
    --segmented-control-radius: var(--radius-full);
    --segmented-control-option-radius: var(--radius-full);
  }
}

.SegmentedControlOption {
  position: relative;
  padding: 0 var(--segmented-control-option-gutter);
  border-radius: var(--segmented-control-option-radius);
  color: var(--color-text-secondary);
  cursor: pointer;
  line-height: 1;
  display: flex;
  flex-shrink: 0;
  align-items: center;
  justify-content: center;
  transition-duration: var(--transition-duration-basic);
  transition-property: opacity, background-color, color;
  transition-timing-function: var(--transition-ease-basic);

  &:focus {
    outline: 0;
  }

  :where(.SegmentedControl[data-block]) & {
    flex: 1;
  }

  :where(.SegmentedControl[data-pill]) & {
    min-width: calc(var(--segmented-control-size) - 2 * var(--segmented-control-gutter));
    padding: 0 calc(var(--segmented-control-option-gutter) * var(--control-gutter-pill-scaling));
  }

  &[data-state="on"]:focus-visible {
    outline: 2px solid var(--color-ring);
  }

  &::before {
    position: absolute;
    inset: var(--segmented-control-option-highlight-gutter);
    border-radius: var(--segmented-control-option-radius);
    background: var(--segmented-control-option-highlight-background-color);
    content: "";
    opacity: 0;
    pointer-events: none;
    transform: scale(1);
    transition-duration: var(--transition-duration-basic);
    transition-property: opacity, transform;
    transition-timing-function: var(--transition-ease-basic);
    will-change: transform;
  }

  &:active::before {
    transform: scale(var(--scale), 0.97);
  }

  svg {
    display: block;
  }

  &[data-state="off"]:where(:not([disabled])) {
    @mixin hover {
      color: var(--color-text);

      &::before {
        opacity: 0.5;
      }
    }

    &:focus-visible {
      color: var(--color-text);
      outline: 2px solid var(--color-ring);
    }

    &:active::before {
      opacity: 0.75;
    }
  }

  &[data-state="on"] {
    color: var(--color-text);
  }

  &[data-disabled] {
    cursor: not-allowed;
    opacity: 0.5;

    &::before {
      opacity: 0 !important;
    }
  }
}

.SegmentedControlThumb {
  position: absolute;
  top: var(--segmented-control-gutter);
  bottom: var(--segmented-control-gutter);
  left: 0;
  border-radius: var(--segmented-control-option-radius);
  background: var(--segmented-control-thumb-background);
  box-shadow: var(--segmented-control-thumb-shadow);
  pointer-events: none;
  will-change: transform;
}

/* =============================================
  Option Content (icon + text + badge layout)
============================================= */
.SegmentedControlOptionContent {
  position: relative;
  display: flex;
  align-items: center;
  gap: var(--segmented-control-content-gap);

  /* Icon auto-sizing (same as Button) */
  svg:where(:not([data-no-autosize])) {
    width: var(--segmented-control-icon-size);
    height: var(--segmented-control-icon-size);
  }

  /* Negative margin for icon when followed by text */
  svg:where(:first-child:not(:only-child)) {
    margin-left: var(--segmented-control-icon-offset);
  }
}

/* =============================================
  Option Badge (CSS-only, no Badge component)
============================================= */
.OptionBadge {
  display: inline-flex;
  align-items: center;
  height: var(--option-badge-size);
  padding: 0 var(--option-badge-gutter);
  border-radius: var(--option-badge-radius);
  background-color: var(--option-badge-bg);
  color: var(--option-badge-color);
  font-size: var(--option-badge-font-size);
  font-weight: var(--option-badge-font-weight);
  letter-spacing: var(--option-badge-tracking);
  white-space: nowrap;
  margin-right: var(--segmented-control-badge-offset);

  /* =============================================
    Soft variant (default)
  ============================================= */
  &[data-variant="soft"] {
    &:where([data-color="secondary"]) {
      --option-badge-bg: var(--color-background-secondary-soft-alpha);
      --option-badge-color: var(--color-text-secondary-soft);
    }

    &:where([data-color="success"]) {
      --option-badge-bg: var(--color-background-success-soft-alpha);
      --option-badge-color: var(--color-text-success-soft);
    }

    &:where([data-color="warning"]) {
      --option-badge-bg: var(--color-background-warning-soft-alpha);
      --option-badge-color: var(--color-text-warning-soft);
    }

    &:where([data-color="danger"]) {
      --option-badge-bg: var(--color-background-danger-soft-alpha);
      --option-badge-color: var(--color-text-danger-soft);
    }

    &:where([data-color="info"]) {
      --option-badge-bg: var(--color-background-info-soft-alpha);
      --option-badge-color: var(--color-text-info-soft);
    }

    &:where([data-color="discovery"]) {
      --option-badge-bg: var(--color-background-discovery-soft-alpha);
      --option-badge-color: var(--color-text-discovery-soft);
    }

    &:where([data-color="caution"]) {
      --option-badge-bg: var(--color-background-caution-soft-alpha);
      --option-badge-color: var(--color-text-caution-soft);
    }
  }

  /* =============================================
    Solid variant
  ============================================= */
  &[data-variant="solid"] {
    &:where([data-color="secondary"]) {
      --option-badge-bg: var(--color-background-secondary-solid);
      --option-badge-color: var(--color-text-secondary-solid);
    }

    &:where([data-color="success"]) {
      --option-badge-bg: var(--color-background-success-solid);
      --option-badge-color: var(--color-text-success-solid);
    }

    &:where([data-color="warning"]) {
      --option-badge-bg: var(--color-background-warning-solid);
      --option-badge-color: var(--color-text-warning-solid);
    }

    &:where([data-color="danger"]) {
      --option-badge-bg: var(--color-background-danger-solid);
      --option-badge-color: var(--color-text-danger-solid);
    }

    &:where([data-color="info"]) {
      --option-badge-bg: var(--color-background-info-solid);
      --option-badge-color: var(--color-text-info-solid);
    }

    &:where([data-color="discovery"]) {
      --option-badge-bg: var(--color-background-discovery-solid);
      --option-badge-color: var(--color-text-discovery-solid);
    }

    &:where([data-color="caution"]) {
      --option-badge-bg: var(--color-background-caution-solid);
      --option-badge-color: var(--color-text-caution-solid);
    }
  }

  /* =============================================
    Outline variant
  ============================================= */
  &[data-variant="outline"] {
    background-color: transparent;
    box-shadow: 0 0 0 1px var(--option-badge-border) inset;

    &:where([data-color="secondary"]) {
      --option-badge-border: var(--color-border-secondary-outline);
      --option-badge-color: var(--color-text-secondary-outline);
    }

    &:where([data-color="success"]) {
      --option-badge-border: var(--color-border-success-outline);
      --option-badge-color: var(--color-text-success-outline);
    }

    &:where([data-color="warning"]) {
      --option-badge-border: var(--color-border-warning-outline);
      --option-badge-color: var(--color-text-warning-outline);
    }

    &:where([data-color="danger"]) {
      --option-badge-border: var(--color-border-danger-outline);
      --option-badge-color: var(--color-text-danger-outline);
    }

    &:where([data-color="info"]) {
      --option-badge-border: var(--color-border-info-outline);
      --option-badge-color: var(--color-text-info-outline);
    }

    &:where([data-color="discovery"]) {
      --option-badge-border: var(--color-border-discovery-outline);
      --option-badge-color: var(--color-text-discovery-outline);
    }

    &:where([data-color="caution"]) {
      --option-badge-border: var(--color-border-caution-outline);
      --option-badge-color: var(--color-text-caution-outline);
    }
  }

  /* =============================================
    Pill
  ============================================= */
  &[data-pill] {
    border-radius: var(--radius-full);
    padding: 0 calc(var(--option-badge-gutter) * var(--control-gutter-pill-scaling));
  }
}
